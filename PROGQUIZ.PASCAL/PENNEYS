//PASC   JOB 'PENNEY', 
//      CLASS=A,MSGCLASS=A,MSGLEVEL=(1,1),
//      REGION=1024K,TIME=(1,0),PRTY=8
/*JOBPARM  ROOM=4242
//CLG EXEC PASCLG,GOTIME=3600,GOREG=1024K,
//      OPT='M+',
//      GOPARM='/STACK=512k'
//COMPILE.SYSIN DD *
/*
//GO.OUTPUT DD SYSOUT=*,OUTLIM=${OUTLIM:-5000}
//GO.SYSIN DD *
        PROGRAM PENNEY;
         
        TYPE
            COINTOSS = (HEADS, TAILS);
            SEQUENCE = ARRAY [1..3] OF COINTOSS;
            PLAYER = RECORD
                BET: SEQUENCE;
                SCORE: INTEGER;
            END;
         
        VAR
            HUMAN, COMPUTER: PLAYER;
            ROUNDS, COUNT: INTEGER;
         
        FUNCTION TOSSCOIN: COINTOSS;
        { RETURNS HEADS OR TAILS AT RANDOM }
        BEGIN
            IF RANDOM(2) = 1 THEN TOSSCOIN := HEADS
            ELSE TOSSCOIN := TAILS
        END;
         
        PROCEDURE PUTTOSS(TOSS: COINTOSS);
        { OUTPUTS HEADS OR TAILS AS A LETTER }
        BEGIN
            IF TOSS = HEADS THEN WRITE('H')
            ELSE WRITE('T')
        END;
         
        FUNCTION GETTOSS: COINTOSS;
        { READS H OR T FROM THE KEYBOARD IN EITHER LETTERCASE }
        VAR C: CHAR;
        BEGIN
            { KEEP READING CHARACTERS UNTIL WE GET AN APPROPRIATE LETTER }
            REPEAT READ(C) UNTIL C IN ['H', 'H', 'T', 'T'];
            { INTERPRET THE LETTER }
            IF C IN ['H', 'H'] THEN GETTOSS := HEADS
            ELSE GETTOSS := TAILS
        END;
         
        PROCEDURE SHOWSEQUENCE(TOSSES: SEQUENCE);
        { OUTPUTS THREE COIN TOSSES AT ONCE }
        VAR
            I: INTEGER;
        BEGIN
            FOR I := 1 TO 3 DO PUTTOSS(TOSSES[I])
        END;
         
        PROCEDURE READSEQUENCE(VAR TOSSES: SEQUENCE);
        { ACCEPTS THREE COIN TOSSES FROM THE KEYBOARD }
        VAR I: INTEGER;
        BEGIN
            { GET THE 3 LETTERS }
            FOR I := 1 TO 3 DO TOSSES[I] := GETTOSS;
            { IGNORE THE REST OF THE LINE }
            READLN
        END;
         
        FUNCTION OPTIMUM(OPPONENT: SEQUENCE): SEQUENCE;
        { GENERATES THE OPTIMUM SEQUENCE AGAINST AN OPPONENT }
        BEGIN
            CASE OPPONENT[2] OF
                HEADS: OPTIMUM[1] := TAILS;
                TAILS: OPTIMUM[1] := HEADS
            END;
            OPTIMUM[2] := OPPONENT[1];
            OPTIMUM[3] := OPPONENT[2]
        END;
         
        FUNCTION RANDOMSEQUENCE: SEQUENCE;
        { GENERATES THREE RANDOM COIN TOSSES }
        VAR
            I: INTEGER;
        BEGIN
            FOR I := 1 TO 3 DO RANDOMSEQUENCE[I] := TOSSCOIN
        END;
         
        FUNCTION MATCH(FIRST, SECOND: SEQUENCE): BOOLEAN;
        { DETECTS WHETHER A SEQUENCE OF TOSSES MATCHES ANOTHER }
        VAR
            DIFFERENT: BOOLEAN;
            I: INTEGER;
        BEGIN
            DIFFERENT := FALSE;
            I := 1;
            WHILE (I <= 3) AND NOT DIFFERENT DO BEGIN
                IF NOT (FIRST[I] = SECOND[I]) THEN DIFFERENT := TRUE;
                I := I + 1
            END;
            MATCH := NOT DIFFERENT
        END;
         
        PROCEDURE PLAYROUND(VAR HUMAN, COMPUTER: PLAYER);
        { SHOWS COIN TOSSES AND ANNOUNCES THE WINNER }
        VAR
            { WE ONLY EVER NEED TO STORE THE 3 MOST RECENT TOSSES IN MEMORY. }
            TOSSES: SEQUENCE;
        BEGIN
            { START WITH THE FIRST THREE TOSSES }
            WRITE('TOSSING THE COIN: ');
    TOSSES := RANDOMSEQUENCE;
    SHOWSEQUENCE(TOSSES);
    { KEEP TOSSING THE COIN UNTIL THERE IS A WINNER. }
    WHILE NOT (MATCH(HUMAN.BET, TOSSES) OR MATCH(COMPUTER.BET, TOSSES)) DO BEGIN
        TOSSES[1] := TOSSES[2];
        TOSSES[2] := TOSSES[3];
        TOSSES[3] := TOSSCOIN;
        PUTTOSS(TOSSES[3])
    END;
    { UPDATE THE WINNER'S SCORE AND ANNOUNCE THE WINNER }
    WRITELN;
    WRITELN;
    IF MATCH(HUMAN.BET, TOSSES) THEN BEGIN
        WRITELN('CONGRATULATIONS! YOU WON THIS ROUND.');
        HUMAN.SCORE := HUMAN.SCORE + 1;
        WRITELN('YOUR NEW SCORE IS ', HUMAN.SCORE, '.')
    END
    ELSE BEGIN
        WRITELN('YAY, I WON THIS ROUND!');
        COMPUTER.SCORE := COMPUTER.SCORE + 1;
        WRITELN('MY NEW SCORE IS ', COMPUTER.SCORE, '.')
    END
END;
 
{ MAIN ALGORITHM }
 
BEGIN
 
    { WELCOME THE PLAYER }
    WRITELN('WELCOME TO PENNEY''S GAME!');
    WRITELN;
    WRITE('HOW MANY ROUNDS WOULD YOU LIKE TO PLAY? ');
    READLN(ROUNDS);
    WRITELN;
    WRITELN('OK, LET''S PLAY ', ROUNDS, ' ROUNDS.');
 
    { START THE GAME }
    RANDOMIZE;
    HUMAN.SCORE := 0;
    COMPUTER.SCORE := 0;
 
    FOR COUNT := 1 TO ROUNDS DO BEGIN
 
        WRITELN;
        WRITELN('*** ROUND #', COUNT, ' ***');
        WRITELN;
 
        { CHOOSE SOMEONE RANDOMLY TO PICK THE FIRST SEQUENCE }
        IF TOSSCOIN = HEADS THEN BEGIN
            WRITE('I''LL PICK FIRST THIS TIME.');
            COMPUTER.BET := RANDOMSEQUENCE;
            WRITE(' MY SEQUENCE IS ');
            SHOWSEQUENCE(COMPUTER.BET);
            WRITELN('.');
            REPEAT
                WRITE('WHAT SEQUENCE DO YOU WANT? ');
                READSEQUENCE(HUMAN.BET);
                IF MATCH(HUMAN.BET, COMPUTER.BET) THEN
                    WRITELN('HEY, THAT''S MY SEQUENCE! THINK FOR YOURSELF!')
            UNTIL NOT MATCH(HUMAN.BET, COMPUTER.BET);
            SHOWSEQUENCE(HUMAN.BET);
            WRITELN(', HUH? SOUNDS OK TO ME.')
        END
        ELSE BEGIN
            WRITE('YOU PICK FIRST THIS TIME. ENTER 3 LETTERS H OR T: ');
            READSEQUENCE(HUMAN.BET);
            COMPUTER.BET := OPTIMUM(HUMAN.BET);
            WRITE('OK, SO YOU PICKED ');
            SHOWSEQUENCE(HUMAN.BET);
            WRITELN;
            WRITE('MY SEQUENCE WILL BE ');
            SHOWSEQUENCE(COMPUTER.BET);
            WRITELN
        END;
 
        { THEN WE CAN ACTUALLY PLAY THE ROUND }
        WRITELN('LET''S GO!');
        WRITELN;
        PLAYROUND(HUMAN, COMPUTER);
        WRITELN;
        WRITELN('PRESS ENTER TO GO ON...');
        READLN
 
    END;
 
    { ALL THE ROUNDS ARE FINISHED; TIME TO DECIDE WHO WON }
    WRITELN;
    WRITELN('*** END RESULT ***');
    WRITELN;
    IF HUMAN.SCORE > COMPUTER.SCORE THEN WRITELN('CONGRATULATIONS! YOU WON!')
    ELSE IF COMPUTER.SCORE > HUMAN.SCORE THEN WRITELN('HOORAY! I WON')
    ELSE WRITELN('COOL, WE TIED.');
    WRITELN;
    WRITELN('PRESS ENTER TO FINISH.');
    READLN
 
END.

